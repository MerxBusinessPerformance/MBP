<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <record id="view_task_form2" model="ir.ui.view">
        <field name="name">project.task.form.inherit</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_form2" />
        <field name="arch" type="xml">
            <xpath expr="//field[@name='date_last_stage_update']" position="after">
                <field name="business_requirement_deliverable_id" groups="business_requirement.group_business_requirement_user"/>
                <field name="business_requirement_id"/>
            </xpath>
            <xpath expr="//div[@name='button_box']" position="inside">
                <button
                    type="object"
                    name="action_view_deliverable"
                    class="oe_stat_button"
                    icon="fa-tasks"
                    attrs="{'invisible': [('business_requirement_deliverable_id', '=', False)]}"
                    string="Deliverable"
                >
                </button>
            </xpath>
        </field>
    </record>

    <record id="view_business_requirement_task_form" model="ir.ui.view">
        <field name="model">business.requirement</field>
        <field name="inherit_id" ref="business_requirement.view_business_requirement_form"/>
        <field name="groups_id" eval="[(4, ref('sales_team.group_sale_salesman'))]" />
        <field name="arch" type="xml">
            <xpath expr='//field[@name="partner_id"]' position="after">
                <field name="project_id"/>
            </xpath>
            <xpath expr='//page[@name="logs"]' position='after'>
                <page string="Backlog" name="tasks">
                    <field name="task_ids" widget="section_and_note_one2many" mode="tree" nolabel="1">
                        <tree editable="bottom">
                            <field name="business_requirement_deliverable_id" optional="hide"/>
                            <field name="is_closed" invisible="1"/><field name="sequence" invisible="1" readonly="1"/><field name="name"/>
                            <field name="project_id" optional="show"/>
                            <field name="partner_id" optional="hide"/>
                            <field name="parent_id" groups="project.group_subtask_project" optional="hide"/>
                            <field name="planned_hours" widget="timesheet_uom_no_toggle" sum="Initially Planned Hours" optional="hide"/>
                            <field name="effective_hours" widget="timesheet_uom" sum="Effective Hours" optional="show"/>
                            <field name="user_ids" optional="show" widget="many2many_avatar_user" domain="[('share', '=', False), ('active', '=', True)]"/>
                            <field name="company_id" groups="base.group_multi_company" optional="hide"/>
                            <field name="activity_ids" widget="list_activity" optional="show"/>
                            <field name="date_deadline" optional="show" widget="remaining_days" attrs="{'invisible': [('is_closed', '=', True)]}"/>
                            <field name="tag_ids" widget="many2many_tags" options="{'color_field': 'color'}" optional="show"/>
                            <field name="kanban_state" widget="state_selection" optional="hide" readonly="1"/>
                            <field name="stage_id" invisible="context.get('set_visible',False)" optional="show"/>
                        </tree>
                    </field>
                </page>
            </xpath>
        </field>
    </record>

   <record id="view_business_requirement_task_tree" model="ir.ui.view">
        <field name="model">business.requirement</field>
        <field name="inherit_id" ref="business_requirement.view_business_requirement_tree"/>
        <field name="groups_id" eval="[(4, ref('sales_team.group_sale_salesman'))]" />
        <field name="arch" type="xml">
            <xpath expr='//field[@name="category_ids"]' position="replace">
                <field name="project_id"/>
                <field name="task_ids"/>
            </xpath>
            <xpath expr='//field[@name="priority"]' position="replace">
                <field name="priority" widget="priority"/>
            </xpath>
        </field>
    </record>
</odoo>
